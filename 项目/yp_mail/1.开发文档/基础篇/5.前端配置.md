### ElementUI后台管理

#### 请求的baseUrl

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1653231089303-d93ccd76-5a5a-4638-85b9-4b684945fc8f.png#averageHue=%23f2f1f1&clientId=ucc8fc733-16b0-4&from=paste&height=885&id=ue1182936&name=image.png&originHeight=1548&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=356768&status=done&style=none&taskId=u78b8bef0-d8f7-4451-88d3-9a319b5ed3e&title=&width=1462.857142857143)

### 路由

### 

### tree组件node拖动深度问题

> Ps: 拖动的node无论是否包含自己点, 深度都不能超过3

```javascript
// 表示: 是否允许节点拖拽
allowDrop(draggingNode, dropNode, type) {
  // 1.  当前被拖动的节点以及父节点层数不能超过3
  // 1.1 被拖动的当前节点总数
  this.countNodeLevel(draggingNode.data);
  console.log("当前节点信息: ", draggingNode, dropNode, type);
  // 当前被拖动的节点深度+父节点深度不能大于3
  console.log("最大深度", this.maxLevel);
  console.log("当前节点深度: ", draggingNode.data.catLevel);
  let deep = this.maxLevel - draggingNode.data.catLevel + 1;
  console.log("深度: ", deep);
  if (type === 'inner') {
    return deep + dropNode.level <= 3;
  } else {
    return deep + dropNode.parent.level <= 3;
  }
},
  
  // 统计节点深度函数
  countNodeLevel(node) {
    if (node != null && node.childCategories.length > 0) {
      for (let index = 0; index < node.childCategories.length; index++) {
        if (node.childCategories[index].catLevel > this.maxLevel) {
          this.maxLevel = node.childCategories[index].catLevel;
        }
        // 递归查看子项深度
        this.countNodeLevel(node.childCategories[index]);
      }
    } else {
      this.maxLevel = node.catLevel;
    }
  }
}
```

> `let deep = this.maxLevel - draggingNode.data.catLevel + 1;`
> 公式 : elementui tree, 节点拖动公式

### 

### 关闭esline语法检查

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1653815621411-0603e215-a3e0-4ace-b8f6-898199370fef.png#averageHue=%23efeded&clientId=u3613c48f-eb86-4&from=paste&height=622&id=uef310bee&name=image.png&originHeight=1089&originWidth=1792&originalType=binary&ratio=1&rotation=0&showTitle=false&size=249768&status=done&style=none&taskId=ud90bebb6-a7c4-4603-bb4a-e1e8ab85ea2&title=&width=1024)

### 表格的自定义列表

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1653816494206-f9bb5b6f-364b-4200-9b0e-b889a9eb870d.png#averageHue=%23fdfcfc&clientId=u3613c48f-eb86-4&from=paste&height=624&id=uce2309af&name=image.png&originHeight=1092&originWidth=2045&originalType=binary&ratio=1&rotation=0&showTitle=false&size=179224&status=done&style=none&taskId=uf07c8abe-8060-419c-ac7e-19ecf17f21d&title=&width=1168.5714285714287)

```html
<template slot-scope="scope">
  <!-- 开关开启数字状态需要前面加: -->
  <el-switch v-model="scope.row.showStatus" :active-value="1" :inactive-value="0" active-color="#13ce66" inactive-color="#ff4949">
  </el-switch>
 </template>
```

### 开关状态

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1653818490283-b9c530ae-6f61-4abf-bb8a-84bca2707db6.png#averageHue=%23fefefe&clientId=u3613c48f-eb86-4&from=paste&height=110&id=u4b1a1ffc&name=image.png&originHeight=193&originWidth=2121&originalType=binary&ratio=1&rotation=0&showTitle=false&size=37800&status=done&style=none&taskId=ue17c5b7b-79d0-4813-8a43-42ef2cf10da&title=&width=1212)

```html
<el-table-column prop="showStatus" header-align="center" align="center" label="显示状态">
  <template slot-scope="scope">
    <!-- 开关开启数字状态需要前面加: -->
    <el-switch v-model="scope.row.showStatus" :active-value="1" :inactive-value="0" active-color="#13ce66" inactive-color="#ff4949">
    </el-switch>
  </template>
</el-table-column>
```

### 文件上传及存储

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1653839898254-5d5f298c-d169-4d0c-a72f-ac57bb9e061a.png#averageHue=%23f2f0ed&clientId=u3613c48f-eb86-4&from=paste&height=625&id=uc5cf430d&name=image.png&originHeight=1093&originWidth=2000&originalType=binary&ratio=1&rotation=0&showTitle=false&size=230582&status=done&style=none&taskId=u5fadf05b-c9c7-462d-883b-d9ebd19e29d&title=&width=1142.857142857143)

> 第一种: 服务器压力太大, QPS高时

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654225851846-d2ac50e2-a624-4993-bd3f-6461be73c530.png#averageHue=%23f4f4f4&clientId=u3c7b0f48-6f65-4&from=paste&height=524&id=u9933733a&name=image.png&originHeight=917&originWidth=1806&originalType=binary&ratio=1&rotation=0&showTitle=false&size=529361&status=done&style=shadow&taskId=u4964d8df-37f0-47a5-90a8-989b1ac59b8&title=&width=1032)

> 第二种: 签名上传, 用户直接将图片上传到阿里云存储

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654225868864-fa346ea7-6d73-4b91-a4e6-cd33fe0e7e11.png#averageHue=%23f1f1f1&clientId=u3c7b0f48-6f65-4&from=paste&height=564&id=u596f76c2&name=image.png&originHeight=987&originWidth=1807&originalType=binary&ratio=1&rotation=0&showTitle=false&size=736609&status=done&style=shadow&taskId=u41a776a4-45f3-4b3f-9a31-eb61636ff46&title=&width=1032.5714285714287)

### 签名文件上传

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654270447437-7f31322f-ba87-4a57-b2c2-8b8c65c7e1b1.png#averageHue=%23f9f7f4&clientId=u50b4bed2-1d04-4&from=paste&height=885&id=u53050150&name=image.png&originHeight=1548&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=782243&status=done&style=none&taskId=u774b46b5-bcc0-48be-b291-500f390ad30&title=&width=1462.857142857143)

## 文件上传组件

```javascript
import http from '@/utils/httpRequest.js'
export function policy() {
  return new Promise((resolve, reject) => {
    http({
      url: http.adornUrl('/thirdparty/oss/policy'),
      method: 'get',
      params: http.adornParams({})
    }).then(({
      data
    }) => {
      resolve(data)
    })
  })
}
```

```html
<template>
  <div>
    <!-- action: 表示文件上传地址 阿里云外网访问Bucket域名: youpin-mail.oss-cn-nanjing.aliyuncs.com-->
    <el-upload action="http://youpin-mail.oss-cn-nanjing.aliyuncs.com" :data="dataObj" list-type="picture-card"
               :file-list="fileList" :before-upload="beforeUpload" :on-remove="handleRemove" :on-success="handleUploadSuccess"
               :on-preview="handlePreview" :limit="maxCount" :on-exceed="handleExceed">
      <i class="el-icon-plus"></i>
    </el-upload>
    <el-dialog :visible.sync="dialogVisible">
      <img width="100%" :src="dialogImageUrl" alt />
    </el-dialog>
  </div>
</template>
<script>
  import {
    policy
  } from "./policy";
  import {
    getUUID
  } from '@/utils'
  export default {
    name: "multiUpload",
    props: {
      //图片属性数组
      value: Array,
      //最大上传图片数量
      maxCount: {
        type: Number,
        default: 30
      }
    },
    data() {
      return {
        dataObj: {
          policy: "",
          signature: "",
          key: "",
          ossaccessKeyId: "",
          dir: "",
          host: "",
          uuid: ""
        },
        dialogVisible: false,
        dialogImageUrl: null
      };
    },
    computed: {
      fileList() {
        let fileList = [];
        for (let i = 0; i < this.value.length; i++) {
          fileList.push({
            url: this.value[i]
          });
        }
        
        return fileList;
      }
    },
    mounted() {},
    methods: {
      emitInput(fileList) {
        let value = [];
        for (let i = 0; i < fileList.length; i++) {
          value.push(fileList[i].url);
        }
        this.$emit("input", value);
      },
      handleRemove(file, fileList) {
        this.emitInput(fileList);
      },
      handlePreview(file) {
        this.dialogVisible = true;
        this.dialogImageUrl = file.url;
      },
      beforeUpload(file) {
        let _self = this;
        return new Promise((resolve, reject) => {
          policy()
            .then(response => {
            console.log("这是什么${filename}");
            _self.dataObj.policy = response.data.policy;
            _self.dataObj.signature = response.data.signature;
            _self.dataObj.ossaccessKeyId = response.data.accessid;
            _self.dataObj.key = response.data.dir + "/" + getUUID() + "_${filename}";
            _self.dataObj.dir = response.data.dir;
            _self.dataObj.host = response.data.host;
            resolve(true);
          })
            .catch(err => {
            console.log("出错了...", err)
            reject(false);
          });
        });
      },
      handleUploadSuccess(res, file) {
        this.fileList.push({
          name: file.name,
          // url: this.dataObj.host + "/" + this.dataObj.dir + "/" + file.name； 替换${filename}为真正的文件名
          url: this.dataObj.host + "/" + this.dataObj.key.replace("${filename}", file.name)
        });
        this.emitInput(this.fileList);
      },
      handleExceed(files, fileList) {
        this.$message({
          message: "最多只能上传" + this.maxCount + "张图片",
          type: "warning",
          duration: 1000
        });
      }
    }
  };
  
</script>
<style>
</style>

```

```html
<template> 
  <div>
    <el-upload action="http://youpin-mail.oss-cn-nanjing.aliyuncs.com" :data="dataObj" list-type="picture"
      :multiple="false" :show-file-list="showFileList" :file-list="fileList" :before-upload="beforeUpload"
      :on-remove="handleRemove" :on-success="handleUploadSuccess" :on-preview="handlePreview">
      <el-button size="small" type="primary">点击上传</el-button>
      <div slot="tip" class="el-upload__tip">只能上传jpg/png文件，且不超过10MB</div>
    </el-upload>
    <el-dialog :visible.sync="dialogVisible">
      <img width="100%" :src="fileList[0].url" alt="">
    </el-dialog>
  </div>
</template>
<script>
  import {
    policy
  } from './policy'
  import {
    getUUID
  } from '@/utils'

  export default {
    name: 'singleUpload',
    props: {
      value: String
    },
    computed: {
      imageUrl() {
        return this.value;
      },
      imageName() {
        if (this.value != null && this.value !== '') {
          return this.value.substr(this.value.lastIndexOf("/") + 1);
        } else {
          return null;
        }
      },
      fileList() {
        return [{
          name: this.imageName,
          url: this.imageUrl
        }]
      },
      showFileList: {
        get: function () {
          return this.value !== null && this.value !== '' && this.value !== undefined;
        },
        set: function (newValue) {}
      }
    },
    data() {
      return {
        dataObj: {
          policy: '',
          signature: '',
          key: '',
          ossaccessKeyId: '',
          dir: '',
          host: '',
          // callback:'',
        },
        dialogVisible: false
      };
    },
    methods: {
      emitInput(val) {
        this.$emit('input', val)
      },
      handleRemove(file, fileList) {
        this.emitInput('');
      },
      handlePreview(file) {
        this.dialogVisible = true;
      },
      beforeUpload(file) {
        let _self = this;
        return new Promise((resolve, reject) => {
          policy().then(response => {
            _self.dataObj.policy = response.data.policy;
            _self.dataObj.signature = response.data.signature;
            _self.dataObj.ossaccessKeyId = response.data.accessid;
            _self.dataObj.key = response.data.dir + '/' + getUUID() + '_${filename}';
            _self.dataObj.dir = response.data.dir;
            _self.dataObj.host = response.data.host;
            resolve(true)
          }).catch(err => {
            reject(false)
          })
        })
      },
      handleUploadSuccess(res, file) {
        console.log("上传成功...")
        this.showFileList = true;
        this.fileList.pop();
        this.fileList.push({
          name: file.name,
          url: this.dataObj.host + '/' + this.dataObj.key.replace("${filename}", file.name)
        });
        this.emitInput(this.fileList[0].url);
      }
    }
  }

</script>
<style>

</style>

```

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654323623275-fbc33c51-1886-489f-a959-99d7ebfe2923.png#averageHue=%23f2f1f1&clientId=ue97bc46a-acf8-4&from=paste&height=885&id=u81a0f060&name=image.png&originHeight=1548&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=382230&status=done&style=none&taskId=u60839797-745e-4926-840d-4149c5e4df3&title=&width=1462.857142857143)![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654323638302-4af0b14f-9641-4c4d-82fb-50f2ed98f73b.png#averageHue=%23fafafa&clientId=ue97bc46a-acf8-4&from=paste&height=885&id=u8370914d&name=image.png&originHeight=1548&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=310698&status=done&style=none&taskId=u4e2901a9-a9c6-4718-b7c3-98ee7c0977f&title=&width=1462.857142857143)

### 文件上传跨域问题

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654339412532-aa4e55ee-3f36-4bfe-8a15-afccba3d3c48.png#averageHue=%23186f63&clientId=ub34ad3c6-1e56-4&from=paste&height=885&id=u9f0a9520&name=image.png&originHeight=1548&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=339604&status=done&style=none&taskId=u903df60f-8c6b-49c1-b765-036160bbf8c&title=&width=1462.857142857143)

> 阿里云存储需要单独设置跨域

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654340785335-db136570-82e5-44df-a64b-2d8b8cb1723e.png#averageHue=%23c0bfbf&clientId=ub34ad3c6-1e56-4&from=paste&height=885&id=u71e085a2&name=image.png&originHeight=1548&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=288437&status=done&style=none&taskId=ua8b3900c-7c86-4858-b1f8-545dfe1b106&title=&width=1462.857142857143)

### 表格显示上传文件的url

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654521891888-b253fd6c-3a2c-485b-b398-cfdefb300ec7.png#averageHue=%23fbfbfb&clientId=u1a17a356-0707-4&from=paste&height=454&id=u6042a34d&name=image.png&originHeight=794&originWidth=2031&originalType=binary&ratio=1&rotation=0&showTitle=false&size=134026&status=done&style=none&taskId=uf85139fb-06a7-4ab8-a856-8797087ea19&title=&width=1160.5714285714287)

##### 图片组件ElementUI没有

> 需要单独导入

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654522561180-225151a8-74af-421d-ba79-1e94870d0d7f.png#averageHue=%23fbfbfb&clientId=u1a17a356-0707-4&from=paste&height=885&id=ud6a83ba8&name=image.png&originHeight=1548&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=262539&status=done&style=none&taskId=u51a385d8-dd65-4e7a-8b52-dd9ef872ade&title=&width=1462.857142857143)![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654522906426-a9575306-3647-4406-8dc5-814522e74051.png#averageHue=%23f3f2f2&clientId=u1a17a356-0707-4&from=paste&height=885&id=u7856867c&name=image.png&originHeight=1548&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=332025&status=done&style=none&taskId=uecee5beb-cddc-45db-ab03-14f3a4c90a0&title=&width=1462.857142857143)

### 表单校验

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1654526163938-deddaea7-881f-4821-a91a-b9837826e286.png#averageHue=%23fdfdfd&clientId=u1a17a356-0707-4&from=paste&height=885&id=u1765a4b3&name=image.png&originHeight=1548&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=328379&status=done&style=none&taskId=u284e533f-b92a-4080-b779-4f074d7382a&title=&width=1462.857142857143)

```javascript
data() {
  return {
    visible: false,
    dataForm: {
      brandId: 0,
      name: "",
      logo: "",
      descript: "",
      showStatus: 1,
      firstLetter: "",
      sort: ""
    },
    dataRule: {
      name: [{
        required: true,
        message: "品牌名不能为空",
        trigger: "blur"
      }],
      logo: [{
        required: true,
        message: "品牌logo地址不能为空",
        trigger: "blur"
      }],
      descript: [{
        required: true,
        message: "介绍不能为空",
        trigger: "blur"
      }],
      showStatus: [{
        required: true,
        message: "显示状态[0-不显示；1-显示]不能为空",
        trigger: "blur"
      }],
      firstLetter: [{
        // 第一种写法=> validator校验器: rule规格,value填的值,callback回调函数
        validator: (rule, value, callback) => {
          if (value === '' || value == undefined) {
            callback(new Error('首字母不能为空'));
          } else if (!/^[a-zA-Z]$/.test(value)) {
            callback(new Error('首字母必须长度为1的有效字母值'));
          } else {
            // 成功则空回调
            callback();
          }
        },
        required: true,
        trigger: "blur"
      }],
      sort: [{
        required: true,
        message: "排序不能为空",
        trigger: "blur"
      }]
    }
  };
},
```

```javascript
// 校验器: 自定义方法
      var fisrtVerify = (rule, value, callback) => {
        if (value === '' || value == undefined) {
          callback(new Error('首字母不能为空'));
        } else if (!/^[a-zA-Z]$/.test(value)) {
          callback(new Error('首字母必须长度为1的有效字母值'));
        } else {
          // 成功则空回调
          callback();
        }
      };
      return {
        visible: false,
        dataForm: {
          brandId: 0,
          name: "",
          logo: "",
          descript: "",
          showStatus: 1,
          firstLetter: "",
          sort: ""
        },
        dataRule: {
          name: [{
            required: true,
            message: "品牌名不能为空",
            trigger: "blur"
          }],
          logo: [{
            required: true,
            message: "品牌logo地址不能为空",
            trigger: "blur"
          }],
          descript: [{
            required: true,
            message: "介绍不能为空",
            trigger: "blur"
          }],
          showStatus: [{
            required: true,
            message: "显示状态[0-不显示；1-显示]不能为空",
            trigger: "blur"
          }],
          firstLetter: [{
            // 第一种写法=> validator校验器: rule规格,value填的值,callback回调函数
            validator: fisrtVerify,
            required: true,
            trigger: "blur"
          }],
          sort: [{
            required: true,
            message: "排序不能为空",
            trigger: "blur"
          }]
        }
```

## 系统错误码HttpCode

```java
/***
* 错误码和错误信息定义类
* 1. 错误码定义规则为5 为数字
* 2. 前两位表示业务场景，最后三位表示错误码。例如：100001。10:通用001:系统未知
* 异常
* 3. 维护错误码后需要维护错误描述，将他们定义为枚举形式
* 错误码列表：
* 10: 通用
* 001：参数格式校验
* 11: 商品
* 12: 订单
* 13: 购物车
* 14: 物流
*
*
*/
```

### 组件引入

> 引入组件，组件名必须为Xxxx或xxxXxxx，同xxxXxxx的标签可写为<xxxXxxx/>或<xxx-xxxx>

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1655541970991-d1f9e957-dc4d-44a2-9328-04be864cf33d.png#averageHue=%23fefdfd&clientId=u2d66ffc2-9bd4-4&from=paste&height=625&id=u4ff06ef4&name=image.png&originHeight=1094&originWidth=1961&originalType=binary&ratio=1&rotation=0&showTitle=false&size=151004&status=done&style=none&taskId=u71404e7c-2dc0-4dfa-8be9-a962d8fc458&title=&width=1120.5714285714287)

### vue插件的使用

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1664632592893-38ae639a-e012-427a-9c56-f7ddd06a9471.png#averageHue=%23324a4c&clientId=u9a3dd2ad-a2bb-4&from=paste&height=885&id=u4c5061d7&name=image.png&originHeight=1548&originWidth=2560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=379967&status=done&style=none&taskId=u1cbd684e-0dbc-4d92-93d2-269cfe3ced4&title=&width=1462.857142857143)

### 级联选择支持搜索

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1664802846175-e482af82-92c8-4f00-b742-b7d4a606dab0.png#averageHue=%23fbfbfb&clientId=u780fa7f2-e46a-4&from=paste&height=491&id=u85085967&name=image.png&originHeight=860&originWidth=2200&originalType=binary&ratio=1&rotation=0&showTitle=false&size=216184&status=done&style=none&taskId=ue4245849-ff84-433c-975f-11fb16769f6&title=&width=1257.142857142857)