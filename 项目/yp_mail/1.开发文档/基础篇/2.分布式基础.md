## 微服务

微服务架构风格，就像是把一个单独的应用程序开发为一套小服务，每个小服务运行在自
己的进程中，并使用轻量级机制通信，通常是HTTP API。这些服务围绕业务能力来构建，
并通过完全自动化部署机制来独立部署。这些服务使用不同的编程语言书写，以及不同数据
存储技术，并保持最低限度的集中式管理。

简而言之：拒绝大型单体应用，基于业务边界进行服务微化拆分，各个服务独立部署运行
![01、分布式基础&项目环境搭建.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/21571611/1652023544732-4912c246-29db-4259-b2e4-1b7c6c28b9d6.jpeg#averageHue=%23555b57&clientId=u25beed6c-19c9-4&from=drop&id=u5926f631&name=01%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80%26%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.jpg&originHeight=500&originWidth=533&originalType=binary&ratio=1&rotation=0&showTitle=false&size=78388&status=done&style=none&taskId=u2a68ef81-6e5b-4339-9a55-0b4795d6620&title=)

## 集群&分布式&节点

集群是个物理形态，分布式是个工作方式。
只要是一堆机器，就可以叫集群，他们是不是一起协作着干活，这个谁也不知道；

> 《分布式系统原理与范型》定义：
> “分布式系统是若干独立计算机的集合，这些计算机对于用户来说就像单个相关系统”分布式系统（distributed system）是建立在网络之上的软件系统。

分布式是指将不同的业务分布在不同的地方。
集群指的是将几台服务器集中在一起，实现同一业务。

例如：京东是一个分布式系统，众多业务运行在不同的机器，所有业务构成一个大型的业务集群。每一个小的业务，比如用户系统，访问压力大的时候一台服务器是不够的。我们就应该将用户系统部署到多个服务器，也就是每一个业务系统也可以做集群化；

分布式中的每一个节点，都可以做集群。而集群并不一定就是分布式的。
节点：集群中的一个服务器

## 远程调用

在分布式系统中，各个服务可能处于不同主机，但是服务之间不可避免的需要互相调用，我
们称为远程调用

SpringCloud 中使用HTTP+JSON 的方式完成远程调用
![image.png](https://cdn.nlark.com/yuque/0/2023/png/21571611/1676811996381-0c82bd35-af04-470d-a7e5-65f3e36e28a4.png#averageHue=%23e3e3d3&clientId=uf969036d-d2a5-4&from=paste&height=200&id=uedca2444&name=image.png&originHeight=300&originWidth=1039&originalType=binary&ratio=1&rotation=0&showTitle=false&size=126633&status=done&style=none&taskId=ud992fe8a-530b-446e-859f-119c0ff9822&title=&width=692.6666666666666)

## 负载均衡

![image.png](https://cdn.nlark.com/yuque/0/2023/png/21571611/1676812081685-1f5cb60b-09db-4b50-9d59-29eae4216139.png#averageHue=%23fbfbfa&clientId=uf969036d-d2a5-4&from=paste&height=398&id=u52549c5c&name=image.png&originHeight=597&originWidth=1245&originalType=binary&ratio=1&rotation=0&showTitle=false&size=208749&status=done&style=none&taskId=u1ae6c792-ea64-4f4d-935e-f4f1824b21f&title=&width=830)
分布式系统中，A 服务需要调用B 服务，B 服务在多台机器中都存在，A 调用任意一个
服务器均可完成功能。
为了使每一个服务器都不要太忙或者太闲，我们可以负载均衡的调用每一个服务器，提
升网站的健壮性。

> 常见的负载均衡算法：
>
> 轮询：为第一个请求选择健康池中的第一个后端服务器，然后按顺序往后依次选择，直
> 到最后一个，然后循环。
>
> 最小连接：优先选择连接数最少，也就是压力最小的后端服务器，在会话较长的情况下
> 可以考虑采取这种方式。
>
> 散列：根据请求源的IP 的散列（hash）来选择要转发的服务器。这种方式可以一定程
> 度上保证特定用户能连接到相同的服务器。如果你的应用需要处理状态而要求用户能连接到和之前相同的服务器，可以考虑采取这种方式

## 服务注册/发现&注册中心

A 服务调用B 服务，A 服务并不知道B 服务当前在哪几台服务器有，哪些正常的，哪些服务
已经下线。解决这个问题可以引入注册中心
![image.png](https://cdn.nlark.com/yuque/0/2023/png/21571611/1676812131026-6a64664e-72e7-44fa-8c43-d71540348ba5.png#averageHue=%23f6f5f5&clientId=uf969036d-d2a5-4&from=paste&height=463&id=u1a914438&name=image.png&originHeight=694&originWidth=1378&originalType=binary&ratio=1&rotation=0&showTitle=false&size=335319&status=done&style=none&taskId=u829d3eb7-8456-45f5-bec1-ed5061361ff&title=&width=918.6666666666666)
如果某些服务下线，我们其他人可以实时的感知到其他服务的状态，从而避免调用不可用的
服务

## 配置中心

![image.png](https://cdn.nlark.com/yuque/0/2023/png/21571611/1676812234014-25577f4d-e5a8-458d-a2c3-8b70334f1abc.png#averageHue=%23f6f6f6&clientId=uf969036d-d2a5-4&from=paste&height=484&id=u7a27b80f&name=image.png&originHeight=726&originWidth=1479&originalType=binary&ratio=1&rotation=0&showTitle=false&size=324406&status=done&style=none&taskId=u940a24af-5559-433e-a7aa-d9c014cdd94&title=&width=986)每一个服务最终都有大量的配置，并且每个服务都可能部署在多台机器上。我们经常需要变
更配置，我们可以让每个服务在配置中心获取自己的配置

配置中心用来集中管理微服务的配置信息

## 服务熔断与服务降级

在微服务架构中，微服务之间通过网络进行通信，存在相互依赖，当其中一个服务不可用时，有可能会造成雪崩效应。要防止这样的情况，必须要有容错机制来保护服务。
![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1652025175102-e539ba06-c034-4ee3-980f-c2e4e89970bd.png#averageHue=%2322172d&clientId=u25beed6c-19c9-4&from=paste&id=u939f1e43&name=image.png&originHeight=2180&originWidth=2444&originalType=url&ratio=1&rotation=0&showTitle=false&size=240525&status=done&style=none&taskId=ua2fde46f-95d7-44f3-8b47-73657c365fc&title=)
1）、服务熔断
a. 设置服务的超时，当被调用的服务经常失败到达某个阈值，我们可以开
启断路保护机制，后来的请求不再去调用这个服务。本地直接返回默认
的数据
2）、服务降级
a. 在运维期间，当系统处于高峰期，系统资源紧张，我们可以让非核心业
务降级运行。降级：某些服务不处理，或者简单处理【抛异常、返回NULL、
调用Mock 数据、调用Fallback 处理逻辑】

## API 网关

在微服务架构中，API Gateway 作为整体架构的重要组件，它抽象了微服务中都需要的公共
功能，同时提供了客户端负载均衡，服务自动熔断，灰度发布，统一认证，限流流控，日
志统计等丰富的功能，帮助我们解决很多API 管理难题。

![image.png](https://cdn.nlark.com/yuque/0/2022/png/21571611/1652025226594-664cc207-ce79-47e5-9672-a7166688a831.png#averageHue=%23f7fbf7&clientId=u25beed6c-19c9-4&from=paste&height=241&id=ud212f617&name=image.png&originHeight=422&originWidth=928&originalType=binary&ratio=1&rotation=0&showTitle=false&size=210797&status=done&style=none&taskId=uc5ce8814-c0e7-4130-b529-6aa44a70a1b&title=&width=530.2857142857143)

